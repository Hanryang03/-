<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>아쿠아 리서전스 - 심해 탐험</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'JetBrains Mono', monospace;
            touch-action: none;
            user-select: none;
        }

        canvas {
            display: block;
            image-rendering: pixelated;
        }

        /* UI 공통 스타일 */
        .overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 20, 40, 0.95);
            border: 2px solid #00d4ff;
            color: #00d4ff;
            padding: 20px;
            display: none;
            z-index: 1000;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.4);
            border-radius: 8px;
            width: 320px;
        }

        #hud {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            color: #00d4ff;
            display: none;
        }

        #minimap-container {
            width: 140px;
            height: 140px;
            background: rgba(0, 10, 20, 0.9);
            border: 2px solid #008eb3;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.2);
            margin-bottom: 10px;
        }

        .bar-container {
            width: 180px;
            height: 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #00d4ff;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            width: 100%;
            background: #00d4ff;
            transition: width 0.3s ease;
        }

        .equipment-item {
            border: 1px solid #005a70;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .equipment-item:hover {
            background: rgba(0, 212, 255, 0.1);
        }

        .equipment-item.active {
            border-color: #00ffaa;
            background: rgba(0, 255, 170, 0.1);
        }

        #game-over {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column; align-items: center; justify-content: center;
            pointer-events: auto;
            z-index: 2000;
        }

        #interaction-prompt {
            position: absolute;
            bottom: 150px; left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid #00d4ff;
            color: #00d4ff;
            padding: 8px 16px;
            font-size: 14px;
            display: none;
            border-radius: 4px;
            font-weight: bold;
            text-align: center;
            white-space: pre-line;
        }

        #system-msg {
            position: absolute;
            top: 20%; left: 50%;
            transform: translateX(-50%);
            color: #ffaa00; font-weight: bold; font-size: 18px;
            display: none; text-shadow: 0 0 10px #ffaa00;
            z-index: 500;
            text-align: center;
        }

        .key-guide {
            position: absolute;
            bottom: 20px; right: 20px;
            color: rgba(0, 212, 255, 0.5);
            font-size: 10px;
            text-align: right;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>
    
    <div id="interaction-prompt">PRESS [F] TO INTERACT</div>
    <div id="system-msg">MESSAGE AREA</div>
    
    <!-- 인벤토리 UI -->
    <div id="inventory-overlay" class="overlay">
        <h3 class="text-center font-bold border-b border-cyan-800 pb-2 mb-4 tracking-widest">MISSION CARGO</h3>
        <div class="flex justify-between items-center mb-3">
            <span class="opacity-70">ANCIENT RELICS</span>
            <span id="inv-relics" class="text-yellow-400 font-bold">0</span>
        </div>
        <div class="flex justify-between items-center mb-6">
            <span class="opacity-70">SUB GENERATORS</span>
            <span id="inv-gens" class="text-green-400 font-bold">0</span>
        </div>
        <p class="text-[10px] text-center opacity-50 border-t border-cyan-800 pt-3">PRESS [I] TO CLOSE</p>
    </div>

    <!-- 옷장(장비) UI -->
    <div id="wardrobe-overlay" class="overlay">
        <h3 class="text-center font-bold border-b border-cyan-800 pb-2 mb-4 tracking-widest">WARDROBE</h3>
        
        <div id="item-tank" class="equipment-item" onclick="toggleGear('tank')">
            <div class="font-bold text-sm">ADVANCED OXYGEN TANK</div>
            <div class="text-[10px] opacity-70">Max Oxygen +50%</div>
        </div>

        <div id="item-suit" class="equipment-item" onclick="toggleGear('suit')">
            <div class="font-bold text-sm">PRESSURE RESIST SUIT</div>
            <div class="text-[10px] opacity-70">Deep sea threshold: 80M</div>
        </div>

        <p class="text-[10px] text-center opacity-50 border-t border-cyan-800 pt-3 mt-2">CLICK TO EQUIP/UNEQUIP | [F] TO CLOSE</p>
    </div>

    <div class="key-guide">WASD: MOVE | F: INTERACT | I: INVENTORY | G: CRAFT (AT PLANE)</div>

    <!-- 인트로 UI -->
    <div id="intro-ui">
        <h2 class="text-xl font-bold mb-2 uppercase tracking-widest text-cyan-400">Transport Plane Interior</h2>
        <p class="text-sm opacity-70">A/D: 이동 | 옷장, 보관함, 제작대에서 F/G 상호작용</p>
    </div>

    <!-- HUD -->
    <div id="hud">
        <div class="p-6 flex justify-between items-start">
            <div class="flex flex-col">
                <div id="minimap-container">
                    <canvas id="minimapCanvas" width="140" height="140"></canvas>
                </div>
                <div class="flex flex-col gap-2">
                    <div>
                        <div class="text-[10px] font-bold mb-1 tracking-widest uppercase text-cyan-400" id="oxy-label">Oxygen Supply</div>
                        <div class="bar-container"><div id="oxy-bar" class="bar-fill"></div></div>
                    </div>
                </div>
            </div>
            <div class="text-right">
                <div id="depth-meter" class="text-2xl font-bold tracking-tighter text-cyan-400">0M</div>
                <div class="text-[9px] opacity-60 uppercase tracking-widest">Current Depth</div>
                <div id="sub-status" class="text-[10px] mt-2 text-cyan-500 font-bold hidden">SUBMARINE MODE</div>
            </div>
        </div>
    </div>

    <div id="game-over">
        <h1 class="text-4xl font-bold text-red-500 mb-2 uppercase tracking-tighter">Connection Lost</h1>
        <p class="text-gray-400 mb-8">심해 탐사가 중단되었습니다.</p>
        <button onclick="location.reload()" class="px-8 py-3 border border-cyan-400 text-cyan-400 hover:bg-cyan-400 hover:text-black transition-all font-bold uppercase tracking-widest">Restart Mission</button>
    </div>

<script>
    /**
     * AQUA RESURGENCE v9.8.0 - 옷장 및 장비 시스템 업데이트
     */
    
    const CONFIG = {
        world: { width: 10000, height: 100000 },
        seaLevel: 500,
        friction: 0.92, 
        gravity: 0.04,  
        oxyLossRate: 0.05,
        pressureLossRate: 0.15,
        pxPerMeter: 12, 
        ground: { width: 500, y: 500 },
        humanZoom: 2.5,   
        subZoom: 1.2,
        relicsPerGen: 5,        
        gensToFixSub: 3,        
        subSpawnDepth: 100      
    };

    let currentScene = 'intro';

    const PLAYER = {
        introX: 150,
        x: 5000, y: CONFIG.ground.y - 150, 
        vx: 0, vy: 0,
        oxygen: 100, 
        maxOxygen: 100,
        pressureThreshold: 50, // 기본 수압 견딤 수치(m)
        relics: 0,
        generators: 0,
        isDead: false,
        facing: 1,
        width: 40, height: 40, 
        onBoard: false,
        currentZoom: 2.5,
        isEmergency: false,
        inventoryOpen: false,
        wardrobeOpen: false,
        equipped: {
            tank: false,
            suit: false
        }
    };

    const INTRO_OBJECTS = {
        wardrobe: { x: 100, w: 50, h: 90 },
        locker: { x: 300, w: 40, h: 80 },
        craftingTable: { x: 550, w: 60, h: 40 }
    };

    const SUBMARINE = {
        x: 5000, 
        y: CONFIG.seaLevel + (CONFIG.subSpawnDepth * CONFIG.pxPerMeter), 
        vx: 0, vy: 0,
        isActivated: false,
        installedGens: 0
    };

    const ENTITIES = {
        relics: [],
        airPockets: [],
        terrains: []
    };

    const assets = {
        groundImg: new Image(),
        playerImg: new Image(),
        groundLoaded: false,
        playerLoaded: false
    };

    const keys = {};
    let canvas, ctx, miniCanvas, mctx, lastTime = 0;

    function init() {
        canvas = document.getElementById('gameCanvas');
        ctx = canvas.getContext('2d');
        miniCanvas = document.getElementById('minimapCanvas');
        mctx = miniCanvas.getContext('2d');

        window.addEventListener('resize', resize);
        window.addEventListener('keydown', e => {
            keys[e.code] = true;
            if (e.code === 'KeyI') toggleInventory();
            
            if (!PLAYER.inventoryOpen && !PLAYER.wardrobeOpen && !PLAYER.isDead) {
                if (currentScene === 'game') {
                    if (e.code === 'KeyF') handleInteraction();
                    if (e.code === 'KeyG') handleCrafting();
                } else if (currentScene === 'intro') {
                    if (e.code === 'KeyG') handleCrafting();
                    if (e.code === 'KeyF') {
                        if (PLAYER.introX > 700) startGame();
                        else handleIntroInteraction();
                    }
                }
            } else if (PLAYER.wardrobeOpen && e.code === 'KeyF') {
                toggleWardrobe();
            }
        });
        window.addEventListener('keyup', e => { keys[e.code] = false; });

        assets.groundImg.src = '지상.jpg';
        assets.groundImg.onload = () => { assets.groundLoaded = true; };
        assets.playerImg.src = '캐릭터1.png';
        assets.playerImg.onload = () => { 
            assets.playerLoaded = true; 
            PLAYER.aspectRatio = assets.playerImg.height / assets.playerImg.width;
            PLAYER.height = Math.round(PLAYER.width * PLAYER.aspectRatio);
        };

        resize();
        generateWorld();
        requestAnimationFrame(loop);
    }

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        ctx.imageSmoothingEnabled = false;
    }

    function startGame() {
        currentScene = 'game';
        document.getElementById('intro-ui').style.display = 'none';
        document.getElementById('hud').style.display = 'block';
    }

    function toggleInventory() {
        if (PLAYER.wardrobeOpen) return;
        PLAYER.inventoryOpen = !PLAYER.inventoryOpen;
        document.getElementById('inventory-overlay').style.display = PLAYER.inventoryOpen ? 'block' : 'none';
        if (PLAYER.inventoryOpen) {
            document.getElementById('inv-relics').innerText = PLAYER.relics;
            document.getElementById('inv-gens').innerText = PLAYER.generators;
        }
    }

    function toggleWardrobe() {
        PLAYER.wardrobeOpen = !PLAYER.wardrobeOpen;
        document.getElementById('wardrobe-overlay').style.display = PLAYER.wardrobeOpen ? 'block' : 'none';
    }

    function toggleGear(type) {
        PLAYER.equipped[type] = !PLAYER.equipped[type];
        
        // 능력치 즉시 갱신
        PLAYER.maxOxygen = PLAYER.equipped.tank ? 150 : 100;
        PLAYER.pressureThreshold = PLAYER.equipped.suit ? 80 : 50;
        
        // UI 클래스 업데이트
        const el = document.getElementById(`item-${type}`);
        if (PLAYER.equipped[type]) el.classList.add('active');
        else el.classList.remove('active');

        showMessage(PLAYER.equipped[type] ? `${type.toUpperCase()} EQUIPPED` : `${type.toUpperCase()} REMOVED`);
    }

    function showMessage(text) {
        const msg = document.getElementById('system-msg');
        msg.innerText = text;
        msg.style.display = 'block';
        setTimeout(() => { msg.style.display = 'none'; }, 2000);
    }

    function generateWorld() {
        for(let i=0; i<800; i++) {
            ENTITIES.relics.push({
                x: Math.random() * CONFIG.world.width,
                y: CONFIG.seaLevel + 400 + Math.random() * (CONFIG.world.height - CONFIG.seaLevel - 5000),
                collected: false
            });
        }
        for(let i=0; i<400; i++) {
            ENTITIES.terrains.push({
                x: Math.random() * CONFIG.world.width,
                y: CONFIG.seaLevel + 800 + Math.random() * (CONFIG.world.height - CONFIG.seaLevel - 2000),
                w: 80 + Math.random() * 200, h: 80 + Math.random() * 200,
                color: `rgb(${40 + Math.random()*20}, ${35 + Math.random()*15}, ${30 + Math.random()*10})`
            });
        }
    }

    function handleIntroInteraction() {
        if (Math.abs(PLAYER.introX - INTRO_OBJECTS.wardrobe.x) < 40) {
            toggleWardrobe();
        } else if (Math.abs(PLAYER.introX - INTRO_OBJECTS.locker.x) < 40) {
            showMessage("STORAGE IS EMPTY");
        }
    }

    function handleInteraction() {
        const dist = Math.sqrt((PLAYER.x - SUBMARINE.x)**2 + (PLAYER.y - SUBMARINE.y)**2);
        if (dist < 100) {
            if (!SUBMARINE.isActivated) {
                if (PLAYER.generators > 0 && SUBMARINE.installedGens < CONFIG.gensToFixSub) {
                    PLAYER.generators--;
                    SUBMARINE.installedGens++;
                    if (SUBMARINE.installedGens >= CONFIG.gensToFixSub) SUBMARINE.isActivated = true;
                    showMessage("SYSTEM REPAIRED");
                }
            } else {
                PLAYER.onBoard = !PLAYER.onBoard;
                document.getElementById('sub-status').classList.toggle('hidden', !PLAYER.onBoard);
            }
        }
    }

    function handleCrafting() {
        if (currentScene === 'intro') {
            const nearTable = Math.abs(PLAYER.introX - INTRO_OBJECTS.craftingTable.x) < 50;
            if (nearTable) {
                if (PLAYER.relics >= CONFIG.relicsPerGen) {
                    PLAYER.relics -= CONFIG.relicsPerGen;
                    PLAYER.generators++;
                    showMessage("GENERATOR READY");
                }
            }
        }
    }

    function loop(time) {
        const dt = (time - lastTime) / 1000; 
        lastTime = time;
        if (currentScene === 'intro') { updateIntro(dt); drawIntro(); }
        else { if (!PLAYER.isDead && !PLAYER.inventoryOpen) update(dt); draw(); drawMinimap(); }
        requestAnimationFrame(loop);
    }

    function updateIntro(dt) {
        if (PLAYER.inventoryOpen || PLAYER.wardrobeOpen) return;
        const walkSpeed = 200;
        if (keys['KeyA'] || keys['ArrowLeft']) { PLAYER.introX -= walkSpeed * dt; PLAYER.facing = -1; }
        if (keys['KeyD'] || keys['ArrowRight']) { PLAYER.introX += walkSpeed * dt; PLAYER.facing = 1; }
        PLAYER.introX = Math.max(50, Math.min(780, PLAYER.introX));

        const prompt = document.getElementById('interaction-prompt');
        if (Math.abs(PLAYER.introX - INTRO_OBJECTS.wardrobe.x) < 40) {
            prompt.style.display = 'block'; prompt.innerText = "WARDROBE\n[F] TO EQUIP GEAR";
        } else if (Math.abs(PLAYER.introX - INTRO_OBJECTS.locker.x) < 40) {
            prompt.style.display = 'block'; prompt.innerText = "STORAGE LOCKER\n[F] TO CHECK";
        } else if (Math.abs(PLAYER.introX - INTRO_OBJECTS.craftingTable.x) < 50) {
            prompt.style.display = 'block'; prompt.innerText = `CRAFTING TABLE\n[G] TO MAKE GENERATOR`;
        } else if (PLAYER.introX > 700) {
            prompt.style.display = 'block'; prompt.innerText = "AIRLOCK DOOR\n[F] TO JUMP";
        } else {
            prompt.style.display = 'none';
        }
    }

    function update(dt) {
        const targetZoom = PLAYER.onBoard ? CONFIG.subZoom : CONFIG.humanZoom;
        PLAYER.currentZoom += (targetZoom - PLAYER.currentZoom) * 0.05;

        let ax = 0, ay = 0;
        const swimPower = PLAYER.onBoard ? 1.2 : 0.8; 
        if (!PLAYER.isEmergency) {
            if (keys['ArrowUp'] || keys['KeyW']) ay -= swimPower;
            if (keys['ArrowDown'] || keys['KeyS']) ay += swimPower;
            if (keys['ArrowLeft'] || keys['KeyA']) { ax -= swimPower; PLAYER.facing = -1; }
            if (keys['ArrowRight'] || keys['KeyD']) { ax += swimPower; PLAYER.facing = 1; }
        } else {
            ay = -4.0; 
            if (PLAYER.y <= CONFIG.seaLevel) { PLAYER.isEmergency = false; PLAYER.oxygen = 30; }
        }

        PLAYER.vx += ax; PLAYER.vy += ay;
        PLAYER.vx *= CONFIG.friction; PLAYER.vy *= CONFIG.friction;
        PLAYER.vy += CONFIG.gravity;

        PLAYER.x += PLAYER.vx * dt * 60;
        PLAYER.y += PLAYER.vy * dt * 60;
        PLAYER.x = Math.max(0, Math.min(CONFIG.world.width, PLAYER.x));
        PLAYER.y = Math.max(0, Math.min(CONFIG.world.height, PLAYER.y));

        if (PLAYER.onBoard) { SUBMARINE.x = PLAYER.x; SUBMARINE.y = PLAYER.y; }

        const depthMeters = Math.max(0, (PLAYER.y - CONFIG.seaLevel) / CONFIG.pxPerMeter);
        const isHighPressure = !PLAYER.onBoard && depthMeters > PLAYER.pressureThreshold;

        if (PLAYER.y > CONFIG.seaLevel) {
            let loss = PLAYER.onBoard ? CONFIG.oxyLossRate * 0.4 : CONFIG.oxyLossRate;
            if (isHighPressure) loss *= 4;
            PLAYER.oxygen -= loss * 60 * dt;
        } else PLAYER.oxygen = Math.min(PLAYER.maxOxygen, PLAYER.oxygen + 2.0);

        if (PLAYER.oxygen <= 0) {
            if (PLAYER.onBoard && !PLAYER.isEmergency) { PLAYER.isEmergency = true; }
            else if (!PLAYER.onBoard) { PLAYER.isDead = true; document.getElementById('game-over').style.display = 'flex'; }
        }

        ENTITIES.relics.forEach(r => {
            if (!r.collected && Math.abs(PLAYER.x - r.x) < 50 && Math.abs(PLAYER.y - r.y) < 50) {
                r.collected = true; PLAYER.relics++;
            }
        });

        document.getElementById('oxy-bar').style.width = `${(PLAYER.oxygen / PLAYER.maxOxygen) * 100}%`;
        document.getElementById('depth-meter').innerText = `${Math.floor(depthMeters)}M`;
    }

    function drawIntro() {
        const w = canvas.width, h = canvas.height;
        ctx.fillStyle = '#0a0a0a'; ctx.fillRect(0, 0, w, h);
        ctx.save(); ctx.translate(w / 2 - 400, h / 2 - 100);
        
        ctx.fillStyle = '#1a1a1a'; ctx.fillRect(0, 0, 800, 200);
        ctx.fillStyle = '#333'; ctx.fillRect(0, 180, 800, 20); 
        
        // 옷장 (Wardrobe)
        ctx.fillStyle = '#2c3e50';
        ctx.fillRect(INTRO_OBJECTS.wardrobe.x - 25, 180 - INTRO_OBJECTS.wardrobe.h, INTRO_OBJECTS.wardrobe.w, INTRO_OBJECTS.wardrobe.h);
        ctx.fillStyle = '#34495e'; ctx.fillRect(INTRO_OBJECTS.wardrobe.x - 20, 100, 15, 70); ctx.fillRect(INTRO_OBJECTS.wardrobe.x + 5, 100, 15, 70);
        
        // 보관함
        ctx.fillStyle = '#444'; ctx.fillRect(INTRO_OBJECTS.locker.x - 20, 180 - 80, 40, 80);
        // 제작대
        ctx.fillStyle = '#5d4037'; ctx.fillRect(INTRO_OBJECTS.craftingTable.x - 30, 180 - 40, 60, 40);
        
        ctx.fillStyle = '#004d66'; ctx.fillRect(720, 20, 80, 160);

        ctx.save(); ctx.translate(PLAYER.introX, 180); ctx.scale(PLAYER.facing, 1);
        if (assets.playerLoaded) ctx.drawImage(assets.playerImg, -20, -40, 40, 40);
        ctx.restore();
        ctx.restore();
    }

    function draw() {
        const w = canvas.width, h = canvas.height;
        ctx.fillStyle = '#000'; ctx.fillRect(0, 0, w, h);
        ctx.save();
        ctx.translate(w / 2, h / 2);
        ctx.scale(PLAYER.currentZoom, PLAYER.currentZoom);
        ctx.translate(-PLAYER.x, -PLAYER.y);

        ctx.fillStyle = '#1a2a33'; ctx.fillRect(0, 0, CONFIG.world.width, CONFIG.seaLevel);
        const zoneH = 5000;
        for (let i=0; i<20; i++) {
            const darkness = Math.min(1, i/12);
            ctx.fillStyle = `rgb(0, ${Math.floor(60*(1-darkness))}, ${Math.floor(120*(1-darkness))})`;
            ctx.fillRect(0, CONFIG.seaLevel + i*zoneH, CONFIG.world.width, zoneH);
        }

        ENTITIES.terrains.forEach(t => {
            if (Math.abs(PLAYER.x - t.x) < CONFIG.renderDistance && Math.abs(PLAYER.y - t.y) < CONFIG.renderDistance) {
                ctx.fillStyle = t.color; ctx.fillRect(t.x, t.y, t.w, t.h);
            }
        });

        ctx.fillStyle = '#ffea00';
        ENTITIES.relics.forEach(r => {
            if (!r.collected && Math.abs(PLAYER.x - r.x) < CONFIG.renderDistance) ctx.fillRect(r.x-5, r.y-5, 10, 10);
        });

        ctx.save(); ctx.translate(SUBMARINE.x, SUBMARINE.y); ctx.scale(PLAYER.facing, 1);
        ctx.fillStyle = SUBMARINE.isActivated ? "#00d4ff" : "#555";
        ctx.fillRect(-60, -25, 120, 50); 
        ctx.restore();

        if (!PLAYER.onBoard && assets.playerLoaded) {
            ctx.save(); ctx.translate(PLAYER.x, PLAYER.y); ctx.scale(PLAYER.facing, 1);
            ctx.drawImage(assets.playerImg, -20, -20, 40, 40);
            ctx.restore();
        }
        ctx.restore();

        // 시야 마스크
        if (PLAYER.y > CONFIG.seaLevel - 50) {
            const mask = document.createElement('canvas'); mask.width = w; mask.height = h;
            const mctx_mask = mask.getContext('2d');
            const depthFactor = Math.min(1, (PLAYER.y - CONFIG.seaLevel) / 20000);
            mctx_mask.fillStyle = `rgba(0, 0, 5, ${0.97 * depthFactor})`;
            mctx_mask.fillRect(0, 0, w, h);
            mctx_mask.globalCompositeOperation = 'destination-out';
            const ambientRad = (PLAYER.onBoard ? 450 : 250) * PLAYER.currentZoom;
            const grad = mctx_mask.createRadialGradient(w/2, h/2, 20, w/2, h/2, ambientRad);
            grad.addColorStop(0, "white"); grad.addColorStop(1, "transparent");
            mctx_mask.fillStyle = grad; mctx_mask.beginPath(); mctx_mask.arc(w/2, h/2, ambientRad, 0, Math.PI*2); mctx_mask.fill();
            ctx.drawImage(mask, 0, 0);
        }
    }

    function drawMinimap() {
        mctx.clearRect(0, 0, 140, 140);
        mctx.save(); mctx.beginPath(); mctx.arc(70, 70, 70, 0, Math.PI*2); mctx.clip();
        mctx.fillStyle = '#00050a'; mctx.fillRect(0, 0, 140, 140);
        const zoom = 0.015; const center = 70;
        mctx.fillStyle = PLAYER.onBoard ? '#00d4ff' : '#ffffff';
        mctx.beginPath(); mctx.arc(center, center, 3, 0, Math.PI*2); mctx.fill();
        mctx.restore();
    }

    window.onload = init;
</script>
</body>
</html>
